// --------------------------------------------------------------------------------------------
// khtml javascript library
// --------------------------------------------------------------------------------------------
// (C) Copyright 2010-2011 by Bernhard Zwischenbrugger, Florian Hengartner, Stefan Kemper
//
// Project Info:  http://www.khtml.org
//				  http://www.khtml.org/iphonemap/help.php
//
// This library is free software: you can redistribute it and/or modify
// it under the terms of the GNU Lesser General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
// 
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU Lesser General Public License for more details.
// 
// You should have received a copy of the GNU Lesser General Public License
// along with this library.  If not, see <http://www.gnu.org/licenses/>.
// --------------------------------------------------------------------------------------------
var khtml={};khtml.maplib={};khtml.maplib.base={};khtml.maplib.geometry={};khtml.maplib.overlay={};khtml.maplib.overlay.renderer={};khtml.maplib.parser={};khtml.maplib.ui={};khtml.maplib.util={};khtml.maplib.overlay.renderer={};khtml.maplib.version=function(){return"khtmlib_hsr v0.02"};khtml.maplib.Map=function(a){return new khtml.maplib.base.Map(a)};khtml.maplib.LatLng=function(a,c){return new khtml.maplib.geometry.LatLng(a,c)};khtml.maplib.base.helpers={};khtml.maplib.base.helpers.parseXml=function(a){var c;window.ActiveXObject?(c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(a)):document.implementation&&document.implementation.createDocument&&(c=(new DOMParser).parseFromString(a,"text/xml"));return c};
khtml.maplib.base.helpers.contains=function(a,c){var d=[a.sw().lat(),a.ne().lat()],f=[a.sw().lng(),a.ne().lng()];return(khtml.maplib.base.helpers.between(d,c.sw().lat())||khtml.maplib.base.helpers.between(d,c.ne().lat()))&&(khtml.maplib.base.helpers.between(f,c.sw().lng())||khtml.maplib.base.helpers.between(f,c.ne().lng()))?!0:!1};khtml.maplib.base.helpers.overlaps=function(a,c){return a.sw().lng()<c.ne().lng()&&a.ne().lng()>c.sw().lng()&&a.se().lat()<c.ne().lat()&&a.ne().lat()>c.sw().lat()?!0:!1};
khtml.maplib.base.helpers.overlapsBuggy=function(a,c){var d=[a.sw().lat(),a.ne().lat()],f=[a.sw().lng(),a.ne().lng()],e=[c.sw().lat(),c.ne().lat()],g=[c.sw().lng(),c.ne().lng()];return(khtml.maplib.base.helpers.between(d,c.sw().lat())||khtml.maplib.base.helpers.between(d,c.ne().lat()))&&(khtml.maplib.base.helpers.between(f,c.sw().lng())||khtml.maplib.base.helpers.between(f,c.ne().lng()))||(khtml.maplib.base.helpers.between(e,a.sw().lat())||khtml.maplib.base.helpers.between(e,a.ne().lat()))&&(khtml.maplib.base.helpers.between(g,
a.sw().lng())||khtml.maplib.base.helpers.between(g,a.ne().lng()))?!0:!1};
khtml.maplib.base.helpers.extendBBox=function(a,c){if(!(a instanceof khtml.maplib.geometry.Bounds)){var d=new khtml.maplib.geometry.LatLng(-90,-180),f=new khtml.maplib.geometry.LatLng(90,180);a=new khtml.maplib.geometry.Bounds(f,d)}if(!c)return a;c instanceof khtml.maplib.geometry.LatLng?a=khtml.maplib.base.helpers.extendBBoxByPoint(a,c):(a=khtml.maplib.base.helpers.extendBBoxByPoint(a,c.sw()),a=khtml.maplib.base.helpers.extendBBoxByPoint(a,c.ne()));return a};
khtml.maplib.base.helpers.extendBBoxByPoint=function(a,c){var d=a.sw().lng(),f=a.ne().lat(),e=a.sw().lat(),g=a.ne().lng();c.lat()>f&&(f=c.lat());c.lat()<e&&(e=c.lat());c.lng()<d&&(d=c.lng());c.lng()>g&&(g=c.lng());d=new khtml.maplib.geometry.LatLng(e,d);f=new khtml.maplib.geometry.LatLng(f,g);return new khtml.maplib.geometry.Bounds(d,f)};khtml.maplib.base.helpers.between=function(a,c){return a[0]<=c&&c<=a[1]?!0:!1};
khtml.maplib.base.helpers.cloneObject=function(a){var c={},d;for(d in a)c[d]=typeof a[d]=="object"?cloneObject(a[d]):a[d];return c};khtml.maplib.base.helpers.convertObjectToArray=function(a){for(var c=[],d=0,f=a.length;d<f;d++)c.push(a[d]);return c};
khtml.maplib.base.helpers.eventAttach=function(a,c,d,f,e){var g=arguments.length>5?$a(arguments).slice(5,arguments.length):[],b=function(b){g.unshift(b||window.event);return d.apply(f?f:a,g)};a.addEventListener?(navigator.appName.indexOf("Netscape")==-1&&c=="DOMMouseScroll"&&(c="mousewheel"),navigator.userAgent.indexOf("Safari")!=-1?c=="DOMMouseScroll"?a.onmousewheel=b:a.addEventListener(c,b,e):a.addEventListener(c,b,e)):(c=c=="DOMMouseScroll"?"onmousewheel":"on"+c,a.attachEvent(c,b));return{o:a,
type:c,fn:b,c:e}};khtml.maplib.base.helpers.eventRemove=function(a){a.o.removeEventListener&&a.o.removeEventListener(a.type,a.fn,a.c)};khtml.maplib.base.helpers.mixin=function(a,c,d){if(d)if(d instanceof Array)for(var f=0;f<d.length;f++)a[d[f]]=c[d[f]];else c[d]&&(a[d]=c[d]);else for(f in c)a[f]=c[f]};
khtml.maplib.base.helpers.showOnMap=function(a,c){var d=[];a instanceof khtml.maplib.geometry.Bounds&&(khtml.maplib.base.Log.log("Bounds"),khtml.maplib.base.Log.log("Northwest / Topleft",a.nw()),khtml.maplib.base.Log.log("Northeast / Topright",a.ne()),khtml.maplib.base.Log.log("Southeast / Bottomright",a.se()),khtml.maplib.base.Log.log("Southwest / Bottomleft",a.sw()),d.push(a.nw()),d.push(a.ne()),d.push(a.se()),d.push(a.sw()));for(var f=0;f<d.length;f++){var e=document.createElement("div");e.style.width=
"1px";e.style.height="1px";e.style.color="red";e.style["font-size"]="2em";e.textContent="X";e=new khtml.maplib.overlay.Marker(d[f],e);c.addOverlay(e)}};khtml.maplib.base.helpers.cancelEvent=function(a){a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()};khtml.maplib.base.helpers.stopEventPropagation=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1};khtml.maplib.base.helpers.isIE=function(){return navigator.userAgent.indexOf("MSIE")!=-1};
khtml.maplib.base.helpers.isParentNodeEmpty=function(a){if(khtml.maplib.base.helpers.isIE())return a.parentNode.nodeValue==null;return!a.parentNode};
khtml.maplib.base.helpers.parseLine=function(a){if(a){if(typeof a=="string")a=khtml.maplib.base.helpers.parseLineString;if(typeof a=="object"){for(var c in a){var d=a[c];if(!(d instanceof khtml.maplib.geometry.LatLng)){var f=d[1],e=d[0];a[c]=typeof f=="number"&&typeof e=="number"&&d.length==2?new khtml.maplib.LatLng(f,e):khtml.maplib.base.helpers.parseLine(a[c])}}typeof a[0]=="number"&&typeof a[0]=="number"&&a.length==2&&(a=new khtml.maplib.LatLng(a[0],a[1]));d=a}}else d=[];return d};
khtml.maplib.base.helpers.parseLineString=function(a){if(typeof a=="string"){points=[];a=a.split(" ");for(var c=0;c<a.length;c++){var d=a[c].split(",");d.length==2&&(d[0]=parseFloat(d[0]),d[1]=parseFloat(d[1]),points.push(new khtml.maplib.LatLng(d[0],d[1])))}}return points};
khtml.maplib.base.helpers.parseMultiLine=function(a){if(a&&typeof a=="object")for(var c in a){var d=a[c],f;for(f in d){var e=d[f];if(!(e instanceof khtml.maplib.geometry.LatLng)){var g=e[0];e=e[1];typeof g=="number"&&typeof e=="number"&&(d[f]=new khtml.maplib.LatLng(g,e))}}}else a=[];return a};var stop=0;
khtml.maplib.base.helpers.stringify=function(a,c,d){var f=!0;typeof a.push=="undefined"&&(f=!1);for(var e="",g=c?c+1:c===!1?!1:1,b=e="",i=0;i<g-1;i++)b+="   ";c!==!1&&(b="\n"+b,e=b+"   ");c="";for(var h in a)if(h!="owner"&&typeof a[h]!="function")if(a[h]instanceof khtml.maplib.geometry.Bounds)c+=e+'"bbox":',c+="["+a[h].sw().lng()+","+a[h].sw().lat()+",",c+=""+a[h].ne().lng()+","+a[h].ne().lat()+"]",c+=",";else if(a[h]instanceof khtml.maplib.geometry.LatLng)a.type!="Marker"&&(a.type=="Point"&&(c+=
'"coordinates":'),c+="["+a[h].lng()+","+a[h].lat()+"],");else if(typeof a[h]=="string"){if((h=="type"||d)&&h!="animVal")a[h]!="Marker"&&(c+=e+'"'+h+'":"'+a[h]+'",')}else if(f||h=="type"||h=="features"||a[h]&&a[h].type=="Feature"||h=="geometry"||h=="coordinates"||h=="properties"||h=="bbox"||h=="className")c+=f?e+khtml.maplib.base.helpers.stringify(a[h],g)+",":h=="properties"?e+'"'+h+'":'+khtml.maplib.base.helpers.stringify(a[h],g)+",":e+'"'+h+'":'+khtml.maplib.base.helpers.stringify(a[h],g,!0)+",";
c=c.substring(0,c.length-1);return f?"["+c+"]":"{"+c+b+"}"};khtml.maplib.base.helpers.rotate=function(a,c){var d="rotate("+c+"deg)";a.style.webkitTransform=d;a.style.MozTransform=d;a.style.OTransform=d;if(document.all)rad=c*(Math.PI*2/360),costheta=Math.cos(rad),sintheta=Math.sin(rad),a.filters.item(0).M11=costheta,a.filters.item(0).M12=-sintheta,a.filters.item(0).M21=sintheta,a.filters.item(0).M22=costheta};
khtml.maplib.base.helpers.Boundingbox=function(a){this.map=a;this.div=document.createElement("div");this.div.style.border="1px solid black";this.div.style.position="absolute";this.div.style.strokeDasharray="4,4";this.div.style.zIndex=1;a.mapParent.appendChild(this.div);this.show=function(a){this.div.style.display="";var d=this.map.latlngToXY(a.sw());a=this.map.latlngToXY(a.ne());this.div.style.top=a.y-parseInt(this.div.style.borderWidth)+"px";this.div.style.left=d.x-parseInt(this.div.style.borderWidth)+
"px";this.div.style.width=a.x-d.x+"px";this.div.style.height=-a.y+d.y+"px";this.div.zIndex=10};this.hide=function(){this.div.style.display="none"}};khtml.maplib.base.Map=function(a){typeof a=="string"&&(a=document.getElementById(a));(typeof a!="object"||null==a)&&console.log("Error: map is null or not an object. (map: "+a+")");this.addOverlay=function(b){if(null==b||b instanceof Array)return khtml.maplib.base.Log.warn('Map.addOverlay(): Illegal argument (was "null" or "Array")'),!1;this.overlays.push(b);typeof b.init=="function"&&b.init(this);this.renderOverlay(b)};this.addOverlays=function(b){if(b instanceof Array)for(var i=0;i<b.length;i++)this.addOverlay(b[i]);
else this.addOverlay(b)};this.renderOverlay=function(b){try{b.render()}catch(i){}};this.renderOverlays=function(){for(obj in this.overlays)this.overlays[obj].render()};this.hideOverlays=function(){for(obj in this.overlays)try{this.overlays[obj].clear(e)}catch(b){}};this.removeOverlays=function(){for(;this.overlays.length>0;)this.overlays.pop().clear()};this.stopRenderOverlays=function(){for(obj in this.overlays)typeof this.overlays[obj].cancel=="function"&&this.overlays[obj].cancel()};this.removeOverlay=
function(b){for(var i=0;i<this.overlays.length;i++)if(b==this.overlays[i]){b.clear();this.overlays.splice(i,1);break}};this.callbackFunctions=[];this.addCallbackFunction=function(b){typeof b=="function"&&this.callbackFunctions.push(b)};this._executeCallbackFunctions=function(){for(var b=0;b<this.callbackFunctions.length;b++)this.callbackFunctions[b].call(this)};this.myTimer=function(b){this.reset=function(){this._isRunning=!1};this.isTimeRunning=function(){if(!1==this._isRunning)return!1;if(this.time+
this.myInterval>(new Date).getTime())return!1;this._isRunning=!1;return!0};this.start=function(){this._isRunning=!0;this.time=(new Date).getTime()};this.interval=function(b){if(typeof b!="undefined")this.myInterval=parseInt(b);return this.myInterval};this.reset();this.interval(b);return this};this.oldMoveY=this.oldMoveX=0;this.start=function(b){b.preventDefault?b.preventDefault():b.returnValue=!1;this.moveAnimationBlocked=!0;if(b.touches.length==1){this.startMoveX=this.moveX-b.touches[0].pageX/this.faktor/
this.sc;this.startMoveY=this.moveY-b.touches[0].pageY/this.faktor/this.sc;if(this.mousedownTime!=null&&(new Date).getTime()-this.mousedownTime<this.doubleclickTime){var i=Math.ceil(0.01+this.getZoom()-this.intZoom);this._autoZoomIn(b.touches[0].pageX,b.touches[0].pageY,i)}this.mousedownTime=(new Date).getTime();clearTimeout(this.zoomOutInterval);this.zoomOutInterval=window.setInterval(function(){},20)}if(b.touches.length==2){window.clearInterval(this.zoomOutInterval);this.moveok=!1;i=b.touches[0].pageX;
var a=b.touches[0].pageY,c=b.touches[1].pageX;b=b.touches[1].pageY;this.startDistance=Math.sqrt(Math.pow(c-i,2)+Math.pow(b-a,2));this.startZZ=this.position.zoom;b=(a+b)/2/this.faktor/this.sc;this.startMoveX=this.moveX-(i+c)/2/this.faktor/this.sc;this.startMoveY=this.moveY-b}this.oldMoveX=this.moveX;this.oldMoveY=this.moveY};this.moveok=!0;this.move=function(b){b.preventDefault?b.preventDefault():b.returnValue=!1;if(b.touches.length==1&&this.moveok){this.lastMoveX=this.moveX;this.lastMoveY=this.moveY;
this.lastMoveTime=new Date(b.timeStamp);this.moveX=b.touches[0].pageX/this.faktor/this.sc+this.startMoveX;this.moveY=b.touches[0].pageY/this.faktor/this.sc+this.startMoveY;if(!this.zoomOutStarted){if(Math.abs(this.moveX-this.oldMoveX)>5||Math.abs(this.moveY-this.oldMoveY)>5)window.clearInterval(this.zoomOutInterval),this.zoomOutSpeed=0.01,this.mousedownTime=null;var i=new khtml.maplib.LatLng(this.lat,this.lng);this.setCenter2(i,this.position.zoom);this.moveAnimationBlocked=!1}if(Math.abs(this.moveX-
this.oldMoveX)>5||Math.abs(this.moveY-this.oldMoveY)>5)this.mousedownTime=null}if(b.touches.length==2){this.mousedownTime=null;var a=b.touches[0].pageX,c=b.touches[0].pageY,d=b.touches[1].pageX,f=b.touches[1].pageY;i=Math.sqrt(Math.pow(d-a,2)+Math.pow(f-c,2))/this.startDistance;b=this.startZZ+i-1;b<1&&(b=1);if(b>this.tileSource.maxzoom)b=this.tileSource.maxzoom,i=1;a=(a+d)/2;c=(c+f)/2;faktor=Math.pow(2,b);d=a/faktor-this.width/2;f=c/faktor-this.height/2;i=Math.pow(2,i-1);this.moveX=(a+(d-d*i))/faktor+
this.startMoveX;this.moveY=(c+(f-f*i))/faktor+this.startMoveY;i=new khtml.maplib.LatLng(this.lat,this.lng);this.setCenter2(i,b)}};this.end=function(b){b.preventDefault?b.preventDefault():b.returnValue=!1;window.clearInterval(this.zoomOutInterval);this.zoomOutStarted=!1;this.zoomOutSpeed=0.01;if(b.touches.length==0&&(this.moveok=!0,this.moveAnimationMobile&&this.moveAnimationBlocked==!1)){var i=new Date(b.timeStamp)-this.lastMoveTime;b=(this.lastMoveX-this.moveX)/i*4;i=(this.lastMoveY-this.moveY)/
i*4;var a=this.wheelSpeedConfig.animateMaxSpeed;b>a&&(b=a);i>a&&(i=a);b<-a&&(b=-a);i<-a&&(i=-a);a=Math.pow(2,this.zoom());(Math.abs(b)>this.wheelSpeedConfig.animateMinSpeed/a||Math.abs(i)>this.wheelSpeedConfig.animateMinSpeed/a)&&this._animateMove(b,i,a)}};this.pageX=function(b){try{return(b.pageX===void 0?b.clientX+document.body.scrollLeft:b.pageX)-this.mapLeft}catch(i){return this.lastMouseX}};this.pageY=function(b){try{return(b.pageY===void 0?b.clientY+document.body.scrollTop:b.pageY)-this.mapTop}catch(i){return this.lastMouseY}};
this.doubleclickBlocked=!1;this.doubleclick=function(b){this.discretZoom(1,this.pageX(b),this.pageY(b))};this.mousedown=function(b){this.mapParent.focus();b.preventDefault?b.preventDefault():window.event.returnValue=!1;this.lastMouseX=this.pageX(b);this.lastMouseY=this.pageY(b);this.moveAnimationBlocked=!0;if(this.mousedownTime2!=null&&(new Date).getTime()-this.mousedownTime2<this.doubleclickTime2)this.doubleclick(b);else{this.mousedownTime2=(new Date).getTime();if(b.shiftKey){this.selectRectLeft=
this.pageX(b);this.selectRectTop=this.pageY(b);this.selectRect=document.createElement("div");this.selectRect.style.left=this.selectRectLeft+"px";this.selectRect.style.top=this.selectRectTop+"px";this.selectRect.style.border="1px solid gray";if(!this.internetExplorer)this.selectRect.style.opacity=0.5,this.selectRect.style.backgroundColor="white";this.selectRect.style.position="absolute";this.map.parentNode.appendChild(this.selectRect)}else this.startMoveX=this.moveX-this.pageX(b)/this.faktor/this.sc,
this.startMoveY=this.moveY-this.pageY(b)/this.faktor/this.sc,this.movestarted=!0;return!1}};this.mousemove=function(b){b.preventDefault?b.preventDefault():window.event.returnValue=!1;this.lastMouseX=this.pageX(b);this.lastMouseY=this.pageY(b);if(b.shiftKey){if(this.selectRect){this.selectRect.style.width=Math.abs(this.pageX(b)-this.selectRectLeft)+"px";this.selectRect.style.height=Math.abs(this.pageY(b)-this.selectRectTop)+"px";if(this.pageX(b)<this.selectRectLeft)this.selectRect.style.left=this.pageX(b);
if(this.pageY(b)<this.selectRectTop)this.selectRect.style.top=this.pageY(b)}}else if(this.movestarted)this.lastMoveX=this.moveX,this.lastMoveY=this.moveY,this.lastMoveTime=new Date(b.timeStamp),this.moveX=this.pageX(b)/this.faktor/this.sc+this.startMoveX,this.moveY=this.pageY(b)/this.faktor/this.sc+this.startMoveY,this.setCenter2(new khtml.maplib.LatLng(this.lat,this.lng),this.position.zoom),this.moveAnimationBlocked=!1;return!1};this.mouseup=function(b){b.preventDefault?b.preventDefault():b.returnValue=
!1;this.lastMouseX=this.pageX(b);this.lastMouseY=this.pageY(b);if(this.moveMarker)this.moveMarker=null;if(this.selectRect){var i=this.XYTolatlng(this.selectRect.offsetLeft,this.selectRect.offsetTop+this.selectRect.offsetHeight),a=this.XYTolatlng(this.selectRect.offsetLeft+this.selectRect.offsetWidth,this.selectRect.offsetTop);this._setBounds(new khtml.maplib.geometry.Bounds(i,a));this.selectRect.parentNode.removeChild(this.selectRect);this.selectRect=null}i=new Date(b.timeStamp)-this.lastMoveTime;
if(this.wheelSpeedConfig.moveAnimateDesktop&&i!=0&&this.movestarted&&this.moveAnimationBlocked==!1)b=(this.lastMoveX-this.moveX)/i,i=(this.lastMoveY-this.moveY)/i,a=this.wheelSpeedConfig.animateMaxSpeed,b>a&&(b=a),i>a&&(i=a),b<-a&&(b=-a),i<-a&&(i=-a),a=Math.pow(2,this.zoom()),(Math.abs(b)>this.wheelSpeedConfig.animateMinSpeed/a||Math.abs(i)>this.wheelSpeedConfig.animateMinSpeed/a)&&this._animateMove(b,i,a);var c=this;setTimeout(function(){c.movestarted=!1},1)};this.mouseupIE=function(b){b.preventDefault?
b.preventDefault():b.returnValue=!1;this.lastMouseX=this.pageX(b);this.lastMouseY=this.pageY(b);this.setCenter2(this.XYTolatlng(this.lastMouseX,this.lastMouseY),this.zoom())};this.startZoomTime=null;this.mousewheel=function(b){b.preventDefault?b.preventDefault():b.returnValue=!1;this.mapParent.focus();if(!b)b=window.event;if(b.wheelDelta)var a=b.wheelDelta/60;else if(b.detail)a=-b.detail/3,this.lastWheelDelta*a<0&&(this.wheelSpeedConfig.digizoom||(a=0)),this.lastWheelDelta=-b.detail/3;a=a<0?-1:1;
if(this.wheelSpeedConfig.digizoom)this.discretZoom(a,this.pageX(b),this.pageY(b));else{if(!this.startZoomTime)this.startZoomTime=new Date,this.startZoomTime2=new Date,this.oldZoom=this.zoom(),this.speed=1;var h=new Date-this.startZoomTime,c=new Date-this.startZoomTime2;this.startZoomTime=new Date;if(h>300)this.startZoomTime2=new Date,this.oldZoom=this.zoom(),this.speed=1,c=0.1;this.speed*=2;if(this.speed>5)this.speed=5;a=this.oldZoom+c/3E3*this.speed*a;if(a>this.position.maxZoom)a=this.position.maxZoom;
if(a<this.position.minZoom)a=this.position.minZoom;this.centerAndZoomXY(this.center(),a,this.pageX(b),this.pageY(b))}};this.zoomTimeouts=[];this.discretZoomBlocked=!1;this.discretZoom=function(b,a,h){if(!this.discretZoomBlocked){var c=this;this.discretZoomBlockedTimeout=setTimeout(function(){c.discretZoomBlocked=!1},200);this.discretZoomBlocked=!0;for(var d=1;d<=20;d++)this.zoomTimeouts[d]&&clearTimeout(this.zoomTimeouts[d]);d=this.zoom();var f=b==1?Math.ceil(this.zoom()+0.9):Math.floor(this.zoom()-
0.9);f=Math.abs(d-f);var e=0;for(d=1;d<=20;d++){var j=b*Math.sin(d/20*Math.PI/2)*f;this.zoomTimeouts[d]=this._discretZoomExec(a,h,j-e,d,20);e=j}}};this._discretZoomExec=function(b,a,h,c,d){var f=this;return setTimeout(function(){var e=f.zoom()+h;c==d&&(e=Math.round(e));f.centerAndZoomXY(f.center(),e,b,a)},c*20)};this.digizoomblocked=!1;this.digizoomblockedTimeout=null;this.digizoom=function(b,a,h){this.digizoomblockedTimeout&&clearTimeout(this.digizoomblockedTimeout);var c=this;if(!this.digizoomblocked)this.digizoomblockedTimeout=
setTimeout(function(){c.digizoomblocked=!1},2E3),this.digizoomblocked=!0,h=h>0?Math.ceil(0.01+this.getZoom()-this.getIntZoom()):Math.ceil(this.getZoom()-this.getIntZoom())-0.98,this._autoZoomIn(b,a,h)};this.wheelZoomTimeout=null;this._animateMove=function(b,a,h){clearTimeout(this.animateMoveTimeout);if(!(Math.abs(b)<this.wheelSpeedConfig.animateMinSpeed/h&&Math.abs(a)<this.wheelSpeedConfig.animateMinSpeed/h)){this.moveX+=-b;this.moveY+=-a;var c=this,d=Math.sqrt(Math.pow(b,2)+Math.pow(a,2)),f=b/d,
e=a/d;this.animateMoveTimeout=window.setTimeout(function(){c._animateMove(b-f*c.wheelSpeedConfig.moveAnimationSlowdown/h,a-e*c.wheelSpeedConfig.moveAnimationSlowdown/h,h)},20);this.setCenter2(this.position.center,this.position.zoom)}};this.autoZoomStartTime=this.autoZoomInTimeout=null;this._autoZoomIn=function(b,a,h){this.autoZoomInTimeout&&window.clearTimeout(this.autoZoomInTimeout);var c=0.2;h<0&&(c=-c);zoomGap=!1;Math.abs(h)<=Math.abs(c)&&(zoomGap=!0);var d=this.position.zoom+c;d=Math.round(d*
1E3)/1E3;zoomGap&&(d=h<0?Math.floor(d):Math.ceil(d-0.2),c=d-this.position.zoom);faktor=Math.pow(2,d);var f=b-this.width/2,e=a-this.height/2,j=Math.pow(2,c);f-=f*j;e-=e*j;var g=this;j=(new Date).getMilliseconds();var o=this.autoZoomStartTime?j-this.autoZoomStartTime:0;this.autoZoomStartTime=j;if(o<100||zoomGap){d>=this.tileSource.minzoom&&d<=this.tileSource.maxzoom&&(this.moveX+=f/faktor,this.moveY+=e/faktor);var l=new khtml.maplib.LatLng(this.lat,this.lng);if(d>this.tileSource.maxzoom)d=this.tileSource.maxzoom;
if(d<this.tileSource.minzoom)d=this.tileSource.minzoom;setTimeout(function(){g.setCenter2(l,d)},1)}var p=h-c;zoomGap?this.digizoomblocked=!1:this.autoZoomInTimeout=window.setTimeout(function(){g._autoZoomIn(b,a,p)},40)};this.centerAndZoomXY=function(b,a,c,d){faktor=Math.pow(2,a);b=c-this.mapsize.width/2;d-=this.mapsize.height/2;c=a-this.zoom();c=Math.pow(2,c);b-=b*c;d-=d*c;a>=this.tileSource.minzoom&&a<=this.tileSource.maxzoom&&(this.moveX+=b/faktor,this.moveY+=d/faktor);b=new khtml.maplib.LatLng(this.lat,
this.lng);if(a>this.tileSource.maxzoom)a=this.tileSource.maxzoom;if(a<this.tileSource.minzoom)a=this.tileSource.minzoom;this.setCenter2(b,a)};this.centerAndZoom=function(b,a){this.moveY=this.moveX=0;if(a>this.tileSource.maxzoom)a=this.tileSource.maxzoom;if(a<this.tileSource.minzoom)a=this.tileSource.minzoom;this.record();this.setCenterNoLog(b,a)};this.setCenter3=function(b,a){this.moveY=this.moveX=0;this.setCenterNoLog(b,a)};this.setCenter2=function(b,a){this.record();this.setCenterNoLog(b,a)};this.setCenterNoLogCount=
0;this.setCenterNoLog=function(b,a){this.position.center=b;this.lat=b.lat();this.lng=b.lng();a=parseFloat(a);if(a>this.tileSource.maxzoom)a=this.tileSource.maxzoom;if(a<this.tileSource.minzoom)a=this.tileSource.minzoom;this.position.center=b;this.position.zoom=a;this.layer(this.map,this.lat,this.lng,this.moveX,this.moveY,a);this._executeCallbackFunctions();this._getBounds()};this.center=function(b){typeof b!="undefined"&&this.centerAndZoom(b,this.getZoom());if(this.moveX!=0||this.moveY!=0)return b=
new khtml.maplib.LatLng(this.movedLat,this.movedLng);return this.position.center};this.zoom=function(b){typeof b!="undefined"&&this.centerAndZoom(this.position.center,b);return this.position.zoom};this.moveXY=function(b,a){this.moveX=parseFloat(b)/this.faktor/this.sc+this.moveDelayedX;this.moveY=parseFloat(a)/this.faktor/this.sc+this.moveDelayedY;this.setCenter2(this.center(),this.zoom())};this.tiles=function(b){this.clearMap();this.tileSource=b};this.tileOverlays=[];this.addTilesOverlay=function(b){this.tileOverlays.push(b);
b=this.tileOverlays[this.tileOverlays.length-1];this.clearMap();return b};this.removeTilesOverlay=function(b){for(var a=0;a<this.tileOverlays.length;a++)if(b==this.tileOverlays[a]){this.tileOverlays.splice(a,1);break}this.clearMap()};this._getCenter=function(){if(this.moveX!=0||this.moveY!=0)var b=new khtml.maplib.LatLng(this.movedLat,this.movedLng);else if(this.position.center)b=this.position.center;return b};this.bounds=function(b){if(typeof b!="undefined")this._setBounds(b);else return this.mapBounds};
this.mapBounds=null;this._getBounds=function(){var b=this.XYTolatlng(0,this.height),a=this.XYTolatlng(this.width,0);this.mapBounds=new khtml.maplib.geometry.Bounds(b,a)};this._setBounds=function(b){if(typeof khtml.maplib.geometry.Bounds=="undefined"||!(b instanceof khtml.maplib.geometry.Bounds))return!1;var a=b.sw();b=b.ne();var c=a.lat(),e=b.lat();a=a.lng();b=b.lng();c=d(c);var g=d(e);e=(a+b)/2;var k=f((c+g)/2);e=new khtml.maplib.LatLng(k,e);c=Math.abs(g-c);a=Math.abs(b-a);a/this.width>c/this.height?
b=this.width:(a=c,b=this.height);a=Math.log(360/a/(512/b))/Math.log(2)+1;if(a>this.tileSource.maxzoom)a=this.tileSource.maxzoom;if(a<this.tileSource.minzoom)a=this.tileSource.minzoom;this.position.center?this.wheelSpeedConfig.rectShiftAnimate?this.animatedGoto(e,a,this.wheelSpeedConfig.rectShiftAnimationTime):this.centerAndZoom(e,a):this.centerAndZoom(e,a)};this.animatedGotoStep=null;this.animatedGotoTimeout=[];this.animatedGoto=function(b,a,c){c/=10;var d=this._getCenter(),f=b.lat();b=b.lng();var e=
d.lat(),g=d.lng(),j=this.getZoom(),u=(f-e)/c,o=(b-g)/c,l=(a-j)/c,p=this.moveX/c,x=this.moveY/c,E=this.moveX,q=this.moveY;this.animatedGotoStep=0;for(var v=this;timeout=this.animatedGotoTimeout.pop();)clearTimeout(timeout);for(a=0;a<c;a++)this.animatedGotoTimeout[a]=window.setTimeout(function(){v._animatedGotoExec(e,g,j,u,o,l,E,q,p,x)},10*a)};this._animatedGotoExec=function(b,a,c,d,f,e,g,j,u,o){this.moveX=-u;this.moveY=-o;b+=d*this.animatedGotoStep;a+=f*this.animatedGotoStep;c+=e*this.animatedGotoStep;
this.animatedGotoStep++;this.centerAndZoom(new khtml.maplib.LatLng(b,a),c)};this.getZoom=function(){return this.position.zoom};this.getIntZoom=function(){return this.intZoom};this.latlngToXY=function(b){var a=b.lat(),d=b.lng();a>90&&(a-=180);a<-90&&(a+=180);b=this.getIntZoom();tileTest=c(a,d,b);a=this._getCenter();b=c(a.lat(),a.lng(),b);a=(b[0]-tileTest[0])*this.tileW*this.sc-this.width/2;d=(b[1]-tileTest[1])*this.tileW*this.sc-this.height/2;b=[];b.x=-a;b.y=-d;return b};this.XYTolatlng=function(b,
a){var d=this._getCenter();if(d){var e=Math.pow(2,this.intZoom),g=d.lat();d=d.lng();d=c(g,d,this.intZoom);g=(d[0]+(b-this.width/2)/this.tileW/this.sc)/e*360-180;e=-f((d[1]+(a-this.height/2)/this.tileH/this.sc)/e*360-180)+0;return new khtml.maplib.LatLng(e,g)}};this.mouseToLatLng=function(b){var a=this.pageX(b);b=this.pageY(b);return this.XYTolatlng(a,b)};this.reSize=function(){var b=this;window.setTimeout(function(){b._getSize(b)},1050)};this._getSize=function(){this.width=this.map.parentNode.offsetWidth;
this.height=this.map.parentNode.offsetHeight;var b=this.map,a=0,c=0;do a+=b.offsetLeft,c+=b.offsetTop,b=b.offsetParent;while(b.offsetParent);this.mapTop=c;this.mapLeft=a};this.recordArray=[];this.record=function(){var b=this._getCenter();if(b){var a=b.lat();b=b.lng();var c=this.getZoom();this.recordArray.push([a,b,c])}};this.play=function(b){if(!(b<1)&&!(b>this.recordArray.length-1)){b=this.recordArray[b];var a=new khtml.maplib.LatLng(b[0],b[1]);this.moveY=this.moveX=0;this.setCenter3(a,b[2])}};this.layerDrawLastFrame=
null;this.doTheOverlayes=!0;this.finalDraw=!1;this.moveDelayedY=this.moveDelayedX=this.layerOldZoom=0;this.layerTimer=new this.myTimer(300);this.layer=function(b,a,c,d,f,e){this.stopRenderOverlays();e||(e=this.getZoom());if(this.layerDrawLastFrame)window.clearTimeout(this.layerDrawLastFrame),this.layerDrawLastFrame=null;if(this.layerTimer.isTimeRunning()||this.finalDraw==!1){var g=this,j=function(){g.finalDraw=!0;g.layer(b,a,c,d,f,e)};if(!g.finalDraw)this.layerDrawLastFrame=window.setTimeout(j,100);
if(this.layerTimer.isTimeRunning()){this.moveDelayedX=d;this.moveDelayedY=f;return}}this.layerTimer.start();for(j=this.moveDelayedY=this.moveDelayedX=0;j<22;j++)if(this.layers[j])this.layers[j].layerDiv.style.visibility="hidden";j=this.wheelSpeedConfig.digizoom?Math.floor(e):Math.round(e);if(this.layerOldZoom>e&&!this.finalDraw&&this.layers[j]&&!this.layers[j].loadComplete)this.visibleZoom=j+1;this.intZoom=j;if(j>this.tileSource.maxzoom)j=this.tileSource.maxzoom;if(!this.visibleZoom)this.oldIntZoom=
this.visibleZoom=j;this.faktor=Math.pow(2,j);this.sc=Math.pow(2,e-j);this.loadingZoomLevel=j;if(this.visibleZoom<j&&Math.abs(this.visibleZoom-j)<4)this.loadingZoomLevel=parseInt(this.visibleZoom)+1;this.draw(this.map,a,c,d,f,this.loadingZoomLevel,e,this.tileSource.src);this.layers[this.loadingZoomLevel].layerDiv.style.visibility="";if(j!=this.visibleZoom)this.visibleZoom<j+2?(this.draw(this.map,a,c,d,f,this.visibleZoom,e,this.tileSource.src),this.layers[this.visibleZoom].layerDiv.style.visibility=
""):this.layers[this.visibleZoom].layerDiv.style.visibility="hidden";if(j==this.visibleZoom)this.draw(this.map,a,c,d,f,this.visibleZoom-1,e,this.tileSource.src),this.layers[this.visibleZoom-1].layerDiv.style.visibility="hidden";if(this.layers[this.loadingZoomLevel].loadComplete&&this.visibleLayer!=j)this.layers[this.loadingZoomLevel].loadComplete=!1,this.hideLayer(this.visibleZoom),this.visibleZoom=this.loadingZoomLevel;this.quadtreeTimeout&&clearTimeout(this.quadtreeTimeout);if(this.loadingZoomLevel!=
j)g=this,this.quadtreeTimeout=window.setTimeout(function(){g.layer(b,a,c,d,f)},200);this.oldIntZoom!=this.intZoom&&this.oldIntZoom!=this.visibleZoom&&this.hideLayer(this.oldIntZoom);this.oldIntZoom=j;this.delayedOverlay&&window.clearTimeout(this.delayedOverlay);this.doTheOverlayes||this.finalDraw||this.layerOldZoom==this.zoom()?(j=new Date,this.lastDX=this.moveX,this.lastDY=this.moveY,this.renderOverlays(),this.layerOldZoom=this.zoom(),this.doTheOverlayes=new Date-j>10?!1:!0):this.hideOverlays();
g=this;this.layerBlockTimeout&&clearTimeout(this.layerBlockTimeout);this.layerBlockTimeout=window.setTimeout(function(){g.layerTimer.reset()},20);this.finalDraw=!1};this.draw=function(b,a,e,g,F,k,r,j){this.framesCounter++;var u=this;window.setTimeout(function(){u.framesCounter--},1E3);var o=Math.pow(2,k);if(this.layers[k])l=this.layers[k].layerDiv,p=d(a)-this.layers[k].startLat,e-=this.layers[k].startLng;else{p=c(a,e,k);this.layers[k]=[];this.layers[k].startTileX=p[0];this.layers[k].startTileY=p[1];
this.layers[k].startLat=d(a);this.layers[k].startLng=e;this.layers[k].images={};var l=document.createElement("div");l.setAttribute("zoomlevel",k);l.style.position="absolute";p=b.childNodes;b=!1;for(e=p.length-1;e>=0;e--)a=p.item(e),a.getAttribute("zoomlevel")<k&&(this.map.insertBefore(l,a),b=!0);b||this.map.appendChild(l);this.layers[k].layerDiv=l;var p=0;e=0}l.style.visibility="hidden";l.style.opacity=1;l.style.filter="alpha(opacity=100)";this.movedLng=(this.layers[k].startTileX/o-g/this.tileW)*
360-180+e;this.movedLat=-f((this.layers[k].startTileY/o-F/this.tileH)*360-180-p);p=c(this.movedLat,this.movedLng,k);g=p[0];e=p[1];F=Math.floor(g);b=Math.floor(e);a=this.layers[k].startTileX;var x=this.layers[k].startTileY;g=g-a-(-a+Math.floor(a));var E=e-x-(-x+Math.floor(x)),q;for(q in this.layers[k].images)this.layers[k].images[q].visibility=!1;e=this.width;var v=this.height;y=Math.pow(2,r-k);minX=Math.floor(-e/2/y/this.tileW+g);maxX=Math.ceil(e/2/y/this.tileW+g);minY=Math.floor(-v/2/y/this.tileH+
E);maxY=Math.ceil(v/2/y/this.tileH+E);for(e=minX;e<maxX;e++)for(v=minY;v<maxY;v++){var t=Math.floor(a+e),m=Math.floor(x+v),z=t%o,w=m;z<0&&(z+=o);if(!(w<0)&&!(w>=o)){var B=j(z,w,k);t=B+"-"+t+"-"+m;minsc=this.wheelSpeedConfig.digizoom?1:0.5;if(this.layers[k].images[t]==null&&y>=minsc){m=document.createElement("img");m.style.visibility="hidden";m.style.position="absolute";m.style.left=e*this.tileW+"px";m.style.top=v*this.tileH+"px";m.style.width=this.tileW+"px";m.style.height=this.tileH+"px";if(this.tileSource.opacity)m.style.opacity=
this.tileSource.opacity;l.childNodes.length>0?l.insertBefore(m,l.childNodes.item(0)):l.appendChild(m);this.layers[k].images[t]={};this.layers[k].images[t].img=m;this.layers[k].images[t].array=[];this.layers[k].images[t].array.push(m);this.layers[k].loadComplete=!1;for(ov in this.tileOverlays){var C=this.tileOverlays[ov],A=m.cloneNode(!0);C=C.src(z,w,k);A.setAttribute("overlay",ov);khtml.maplib.base.helpers.eventAttach(A,"load",this.imgLoaded,this,!1);l.appendChild(A);A.setAttribute("src",C);this.layers[k].images[t].array.push(A)}khtml.maplib.base.helpers.eventAttach(m,
"load",this.imgLoaded,this,!1);khtml.maplib.base.helpers.eventAttach(m,"error",this.imgError,this,!1);m.setAttribute("src",B)}if(!this.css3d&&this.layers[k].images[t]){z=this.layers[k].images[t].array;for(w=0;w<z.length;w++){var G=p[0]-F+Math.floor(g);A=p[1]-b+Math.floor(E);var H=Math.round(this.tileW*y);C=Math.round(this.tileH*y);B=Math.floor(-G*H+e*H);m=Math.floor(-A*C+v*C);G=Math.floor(-G*H+(e+1)*H);A=Math.floor(-A*C+(v+1)*C);z[w].style.left=B+"px";z[w].style.top=m+"px";z[w].style.height=G-B+"px";
z[w].style.width=A-m+"px"}}this.layers[k].images[t]&&(this.layers[k].images[t].visibility=!0)}}for(q in this.layers[k].images)if(this.layers[k].images[q].visibility){if(this.layers[k].images[q].array[0].getAttribute("loaded")=="yes"){j=this.layers[k].images[q].array;for(o=0;o<j.length;o++)if(j[o].getAttribute("loaded")=="yes")j[o].style.visibility=""}}else{j=this.layers[k].images[q].array;for(o=0;o<j.length;o++)this.layers[k].images[q].array[o].style.visibility="hidden",this.layers[k].images[q].array[o].getAttribute("loaded")!=
"yes"&&l.removeChild(this.layers[k].images[q].array[o]);delete this.layers[k].images[q].img;delete this.layers[k].images[q]}var y=Math.pow(2,r-k);B=-g*this.tileW;m=-E*this.tileH;if(this.css3d)l.style["-webkit-transform-origin"]=-1*B+"px "+-1*m+"px",l.style.webkitTransform="translate3d("+B+"px,"+m+"px,0px)  "+(" scale3d("+y+","+y+",1) ");l.style.visibility="";l=r=0;for(q in this.layers[this.loadingZoomLevel].images)l++,m=this.layers[this.loadingZoomLevel].images[q].array[0],m.getAttribute("loaded")!=
"yes"&&r++;this.notLoadedImages=r;r<1&&(this.layers[this.loadingZoomLevel].loadComplete=!0);this.loadingZoomLevel==k&&this.imgLoadInfo(l,r)};this.fadeOutTimeout=null;this.fadeOut=function(b,a){this.fadeOutTimeout&&clearTimeout(this.fadeOutTimeout);if(a>0){b.style.opacity=a;b.style.filter="alpha( opacity="+a*100+" )";var c=this;this.fadeOutTimeout=setTimeout(function(){c.fadeOut(b,a-0.2)},40)}else b.style.visibility="hidden"};this.hideLayer=function(b){if(this.intZoom!=b&&this.layers[b])this.layers[b].layerDiv.style.opacity=
1,this.layers[b].layerDiv.style.filter="alpha(opacity=100)",this.fadeOut(this.layers[b].layerDiv,1);if(this.layers[b])for(var a in this.layers[b].images)if(this.layers[b].images[a]&&this.layers[b].images[a].img&&this.layers[b].images[a].img.getAttribute("loaded")!="yes"&&b!=this.intZoom){for(var c=this.layers[b].images[a].array,d=0;d<c.length;d++)this.layers[b].layerDiv.removeChild(this.layers[b].images[a].array[d]);delete this.layers[b].images[a].img;delete this.layers[b].images[a]}};this.ovImgLoaded=
function(b){(b.target?b.target:b.srcElement).style.visibility=""};this.imgLoaded=function(b){b=b.target?b.target:b.srcElement;var a=!0;b.style.visibility="";b.setAttribute("loaded","yes");if(b.parentNode){for(var c=0,d=0,f=b.parentNode.getAttribute("zoomlevel"),e=0;e<b.parentNode.getElementsByTagName("img").length;e++){var g=b.parentNode.getElementsByTagName("img").item(e);g.getAttribute("overlay")||(d++,g.getAttribute("loaded")!="yes"&&(c++,a=!1))}this.notLoadedImages=c;this.loadingZoomLevel==f&&
this.imgLoadInfo(d,c);if((this.layers[f].loadComplete=a)&&this.loadingZoomLevel==f)this.hideLayer(this.visibleZoom),this.hideLayer(this.visibleZoom+1),this.visibleZoom=f}};this.imgError=function(b){var a=b.target?b.target:b.srcElement;a.parentNode&&(a.src!="http://khtml.org/notfound.png"&&a.setAttribute("src","http://khtml.org/notfound.png"),this.imgLoaded(b))};var c=function(a,c,d){return[(c+180)/360*(1<<d),(1-Math.log(Math.tan(a*Math.PI/180)+1/Math.cos(a*Math.PI/180))/Math.PI)/2*(1<<d)]};this._calculateMapSize=
function(){var a=this.mapParent;if(a.currentStyle)var c=a.currentStyle;else window.getComputedStyle&&(c=document.defaultView.getComputedStyle(a,null));var d=parseInt(c.borderTopWidth);isNaN(d)&&(d=0);var f=parseInt(c.borderLeftWidth);isNaN(f)&&(f=0);var e=parseInt(c.borderRightWidth);isNaN(e)&&(e=0);var g=parseInt(c.borderBottomWidth);isNaN(g)&&(g=0);var r=parseInt(c.paddingTop),j=parseInt(c.paddingBottom),u=parseInt(c.paddingLeft),o=parseInt(c.paddingRight),l=r,p=u;e=a.offsetWidth-f-e-u-o;g=a.offsetHeight-
d-g-j-r;r=d+r;u=f+u;for(var x=!0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)u+=a.offsetLeft-a.scrollLeft,r+=a.offsetTop-a.scrollTop,a.currentStyle?c=a.currentStyle:window.getComputedStyle&&(c=document.defaultView.getComputedStyle(a,null)),x&&(c&&c.position=="absolute"&&(x=!1),x&&(p+=a.offsetLeft+a.scrollLeft,l+=a.offsetTop+a.scrollTop),p+=f/2,l+=d/2),a=a.offsetParent;return{top:r,left:u,width:e,height:g,deltaTop:l,deltaLeft:p,deltaBottom:j,deltaRight:o}};this.redraw=function(){this.setMapPosition()};
this.setMapPosition=function(){this.mapsize=this._calculateMapSize();var a=this.mapParent;a.currentStyle||window.getComputedStyle&&document.defaultView.getComputedStyle(a,null);this.mapTop=this.mapsize.top;this.mapLeft=this.mapsize.left;this.width=this.mapsize.width;this.height=this.mapsize.height;relativetop=this.mapsize.deltaTop;relativeleft=this.mapsize.deltaLeft;this.clone.style.top=relativetop+"px";this.clone.style.left=relativeleft+"px";this.clone.style.width=this.mapsize.width+"px";this.clone.style.height=
this.mapsize.height+"px";this.clone.style.position="absolute";this.clone.style.overflow="hidden";this.map.style.left=this.mapsize.width/2+"px";this.map.style.top=this.mapsize.height/2+"px";this._getCenter()&&this.getZoom()&&this.centerAndZoom(this._getCenter(),this.getZoom())};this.clearMap=function(){if(this.map){for(;this.map.firstChild;)this.map.removeChild(this.map.firstChild);for(;this.layers.length>0;)this.layers.pop();this.redraw()}};var d=function(a){return 180/Math.PI*Math.log(Math.tan(Math.PI/
4+a*(Math.PI/180)/2))},f=function(a){return 180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2)};this.imgLoadInfo=function(a,c){if(!this.loadInfoDiv)this.loadInfoDiv=document.createElement("div"),this.loadInfoDiv.style.position="absolute",this.loadInfoDiv.style.top="0px",this.loadInfoDiv.style.right="0px",this.loadInfoDiv.style.backgroundColor="white",this.loadInfoDiv.style.border="1px solid gray",this.loadInfoDiv.style.fontSize="10px",this.map.parentNode.appendChild(this.loadInfoDiv);if(c==
0)this.loadInfoDiv.style.display="none";else{for(this.loadInfoDiv.style.display="";this.loadInfoDiv.firstChild;)this.loadInfoDiv.removeChild(this.loadInfoDiv.firstChild);this.loadInfoDiv.appendChild(document.createTextNode(c+" images to load"))}};this.copyright=function(){var a=document.createElement("img"),c=document.createElement("a");c.setAttribute("href","http://khtml.org");a.setAttribute("src","http://khtml.org/favicon.png");a.style.zIndex=10;a.style.position="absolute";a.style.left="2px";a.style.bottom=
"2px";a.style.width="24px";a.style.height="24px";c.appendChild(a);this.mapParent.appendChild(c)};this.internetExplorer=!1;if(navigator.userAgent.indexOf("MSIE")!=-1)this.internetExplorer=!0;if(navigator.userAgent.indexOf("Android")!=-1){var e=this;setInterval(function(){e.layerTimer.reset()},300)}this.position={};this.tiles({maxzoom:18,minzoom:1,src:function(a,c,d){switch((a+c)%3){case 0:var f="a";break;case 1:f="b";break;case 2:f="c";break;default:f="f"}return"http://"+f+".tile.openstreetmap.org/"+
d+"/"+a+"/"+c+".png"},copyright:"osm"});this.wheelSpeedConfig=[];this.wheelSpeedConfig.acceleration=2;this.wheelSpeedConfig.maxSpeed=2;this.wheelSpeedConfig.animate=!1;navigator.userAgent.indexOf("AppleWebKit")!=-1&&(this.wheelSpeedConfig.animate=!0);navigator.userAgent.indexOf("Opera")!=-1&&(this.wheelSpeedConfig.animate=!1);this.wheelSpeedConfig.animate=!1;this.wheelSpeedConfig.digizoom=!0;this.wheelSpeedConfig.zoomAnimationSlowdown=0.02;this.wheelSpeedConfig.animationFPS=50;this.wheelSpeedConfig.moveAnimateDesktop=
!0;this.wheelSpeedConfig.rectShiftAnimate=!1;this.wheelSpeedConfig.rectShiftAnimationTime=500;this.wheelSpeedConfig.animateMinSpeed=0.4;this.wheelSpeedConfig.animateMaxSpeed=200;this.wheelSpeedConfig.moveAnimationSlowdown=0.4;this.framesCounter=this.wheelEventCounter=0;this.mapParent=a;this.copyright();this.clone=a.cloneNode(!0);this.clone=document.createElement("div");this.clone.removeAttribute("id");a.firstChild?a.insertBefore(this.clone,a.firstChild):a.appendChild(this.clone);this.map=document.createElement("div");
this.map.style.position="absolute";this.clone.appendChild(this.map);this.setMapPosition();this.overlayDiv=document.createElement("div");this.overlayDiv.style.position="absolute";this.clone.appendChild(this.overlayDiv);this.overlays=[];if(khtml.maplib.overlay.FeatureCollection)this.featureCollection=new khtml.maplib.overlay.FeatureCollection,this.featureCollection.map=this,this.addOverlay(this.featureCollection);this.distanceMeasuring="no";this.measureLine=this.moveMarker=null;this.moveAnimationMobile=
!0;this.moveAnimationBlocked=this.moveAnimationDesktop=!1;this.lastMouseX=this.width/2;this.lastMouseY=this.height/2;this.layers=[];this.intZoom=this.oldVisibleZoom=this.visibleZoom=null;this.startMoveY=this.startMoveX=this.lastMoveTime=this.lastMoveY=this.lastMoveX=this.moveY=this.moveX=0;this.sc=1;this.blocked=!1;this.tileH=this.tileW=256;this.position.zoom=1;this.movestarted=!1;this.mousedownTime=null;this.doubleclickTime=400;this.mousedownTime2=null;this.doubleclickTime2=500;this.zoomOutTime=
1E3;this.zoomOutSpeed=0.01;this.zoomOutInterval=null;this.zoomOutStarted=!1;this.zoomSpeedTimer=null;this.zoomAcceleration=1;this.css3d=!1;if(navigator.userAgent.indexOf("iPhone OS")!=-1)this.css3d=!0;if(navigator.userAgent.indexOf("iPad")!=-1)this.css3d=!1;if(navigator.userAgent.indexOf("Safari")!=-1)this.css3d=navigator.userAgent.indexOf("Mac")!=-1?!1:!0;if(navigator.userAgent.indexOf("iPhone OS")!=-1)this.css3d=!0;if(navigator.userAgent.indexOf("Android")!=-1)this.css3d=!1;if(this.internetExplorer){var g=
a;navigator.userAgent.indexOf("Windows Phone OS")!=-1&&khtml.maplib.base.helpers.eventAttach(g,"mouseup",this.mouseupIE,this,!1)}else g=window;khtml.maplib.base.helpers.eventAttach(window,"resize",this.setMapPosition,this,!1);navigator.userAgent.indexOf("Konqueror")!=-1&&(g=a);khtml.maplib.base.helpers.eventAttach(a,"touchstart",this.start,this,!1);khtml.maplib.base.helpers.eventAttach(a,"touchmove",this.move,this,!1);khtml.maplib.base.helpers.eventAttach(a,"touchend",this.end,this,!1);khtml.maplib.base.helpers.eventAttach(g,
"mousemove",this.mousemove,this,!1);khtml.maplib.base.helpers.eventAttach(a,"mousedown",this.mousedown,this,!1);khtml.maplib.base.helpers.eventAttach(g,"mouseup",this.mouseup,this,!1);khtml.maplib.base.helpers.eventAttach(g,"orientationchange",this.reSize,this,!1);khtml.maplib.base.helpers.eventAttach(a,"DOMMouseScroll",this.mousewheel,this,!1);khtml.maplib.base.helpers.eventAttach(a,"dblclick",this.doubleclick,this,!1);typeof this.keyup=="function"&&khtml.maplib.base.helpers.eventAttach(g,"keyup",
this.keyup,this,!1);typeof this.keypress=="function"&&khtml.maplib.base.helpers.eventAttach(g,"keypress",this.keypress,this,!1)};khtml.maplib.geometry.Bounds=function(a,c){this.enlarge=function(a){a.lng()>this.southwest.lng()&&a.lng()>this.northeast.lng()&&this.northeast.lng(a.lng());a.lng()<this.southwest.lng()&&a.lng()<this.northeast.lng()&&this.southwest.lng(a.lng());a.lat()>this.southwest.lat()&&a.lat()>this.northeast.lat()&&this.northeast.lat(a.lat());a.lat()<this.southwest.lat()&&a.lat()<this.northeast.lat()&&this.southwest.lat(a.lat())};this.sw=function(){return this.southwest};this.se=function(){return new khtml.maplib.LatLng(this.southwest.lat(),
this.northeast.lng())};this.ne=function(){return this.northeast};this.nw=function(){return new khtml.maplib.LatLng(this.northeast.lat(),this.southwest.lng())};this.getCenter=function(){return this.center};this.getOpticalCenter=function(a){var c=a.latlngToXY(this.southwest),d=a.latlngToXY(this.northeast);return a.XYTolatlng(Math.abs(c.x+d.x)/2,Math.abs(c.y+d.y)/2)};this.getZoomLevel=function(a){origZoom=a.getZoom();var c=a.latlngToXY(this.southwest),d=a.latlngToXY(this.northeast),b=a.width/Math.abs(c.x-
d.x);a=a.height/Math.abs(c.y-d.y);if(b>a)var i=a;b<=a&&(i=b);return origZoom+Math.log(i)/Math.log(2)};this.getDistance=function(){return this.distance(this.southwest.lat(),this.southwest.lng(),this.northeast.lat(),this.northeast.lng())};this.getInnerRadius=function(){var a=this.distance(this.center.lat(),this.southwest.lng(),this.center.lat(),this.northeast.lng()),c=this.distance(this.southwest.lat(),this.center.lng(),this.northeast.lat(),this.center.lng());return a>c?c/2:a/2};this.distance=function(a,
c,d,b){a=a*Math.PI/180;d=d*Math.PI/180;return Math.acos(Math.sin(a)*Math.sin(d)+Math.cos(a)*Math.cos(d)*Math.cos(b*Math.PI/180-c*Math.PI/180))*180/Math.PI/360*4E7};this.intersects=function(a){if(!(a instanceof khtml.maplib.geometry.Bounds))return khtml.maplib.base.Log.warn('Bounds.intersects(): Illegal argument. Has to be "khtml.maplib.geometry.Bounds"!'),!1;var c=Math.min(this.sw().lat(),this.ne().lat()),d=Math.max(this.sw().lat(),this.ne().lat()),b=Math.min(this.sw().lng(),this.ne().lng()),i=Math.max(this.sw().lng(),
this.ne().lng()),h=[];h.push(a.ne());h.push(a.se());h.push(a.sw());h.push(a.nw());for(a=0;a<h.length;a++){var D=h[a],F=D.lat()>=c&&D.lat()<=d;D=D.lng()>=b&&D.lng()<=i;if(F&&D)return!0}return!1};this.createBoundsFrom2Points=function(a,c){var d=new khtml.maplib.LatLng(Math.min(a.lat(),c.lat()),Math.min(a.lng(),c.lng())),b=new khtml.maplib.LatLng(Math.max(a.lat(),c.lat()),Math.max(a.lng(),c.lng()));return{sw:d,ne:b}};var d=this.createBoundsFrom2Points(a,c);this.southwest=d.sw;this.northeast=d.ne;this.center=
new khtml.maplib.LatLng((this.southwest.lat()+this.northeast.lat())/2,(this.southwest.lng()+this.northeast.lng())/2)};khtml.maplib.geometry.LatLng=function(a,c){this.callbackFunctions=[];this.addCallbackFunction=function(a){typeof a=="function"&&this.callbackFunctions.push(a)};this.executeCallbackFunctions=function(){for(var a=0;a<this.callbackFunctions.length;a++)this.callbackFunctions[a].call(this)};this.lat=function(a){if(typeof a=="number")this.latitude=a,this.executeCallbackFunctions();if(typeof a=="string")this.latitude=parseFloat(a),this.executeCallbackFunctions();return this.latitude};this.lng=function(a){if(typeof a==
"number")this.longitude=a,this.executeCallbackFunctions();if(typeof a=="string")this.longitude=parseFloat(a),this.executeCallbackFunctions();return this.longitude};this.equals=function(a){if(null==a)return!1;if(!(a instanceof khtml.maplib.LatLng))return khtml.maplib.base.Log.warn("Point.equals(): Error - illegal argument!",a),!1;return a.lat()===this.lat()&&a.lng()===this.lng()};a instanceof khtml.maplib.LatLng?(this.lat(a.lat()),this.lng(a.lng())):typeof a=="object"?(a.lat&&this.lat(a.lat),a.lng&&
this.lng(a.lng)):(this.lat(a),this.lng(c))};khtml.maplib.base.Map.prototype.keypress=function(a){var c=!0;switch(a.keyCode){case 37:this.moveit(30,0);break;case 38:this.moveit(0,30);break;case 39:this.moveit(-30,0);break;case 40:this.moveit(0,-30);break;default:c=!1}if(c)return!0;c=typeof a.which!="undefined"?a.which:a.charCode;if(this.internetExplorer)c=a.keyCode;switch(c){case 43:a=Math.ceil(this.getZoom()+0.01)-this.getZoom();this.autoZoomIn(this.mapsize.width/2,this.mapsize.height/2,a);break;case 45:a=Math.floor(this.getZoom()-0.01)-this.getZoom(),
this.autoZoomIn(this.mapsize.width/2,this.mapsize.height/2,a)}return!0};khtml.maplib.base.Map.prototype.keyup=function(){};khtml.maplib.base.Map.prototype.moveit=function(a,c){for(var d=a/20,f=c/20,e=0;e<20;e++){var g=Math.cos(3*(-10+e)/20)*5;this.moveitexec(d*g,f*g,e)}};khtml.maplib.base.Map.prototype.moveitexec=function(a,c,d){var f=this;setTimeout(function(){f.moveXY(a,c)},20*d)};
